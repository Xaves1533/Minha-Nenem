<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nosso Portal Fofo ‚Äî Josias & Vit√≥ria</title>
  <meta name="description" content="Portal fofo, interativo e edit√°vel para celebrar nosso namoro." />
  <style>
    /* ---------- Palette & base ---------- */
    :root{
      --bg1: #fff4f7; --bg2:#fff0f4; --panel:#ffffff;
      --pink:#ff6b97; --pink-2:#ffd3e6; --rose:#ff4d88; --accent:#ff82a8;
      --muted:#8f9bb2; --glass: rgba(255,255,255,0.6);
      --shadow: 0 12px 40px rgba(107,34,64,0.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial;color:#2b1b2a;background:linear-gradient(180deg,var(--bg1),var(--bg2));-webkit-font-smoothing:antialiased}
    a{color:inherit}

    /* ---------- Header / nav ---------- */
    header{position:fixed;left:0;right:0;top:14px;display:flex;justify-content:center;z-index:100}
    .nav{display:flex;gap:8px;padding:8px;border-radius:999px}
    .nav button{background:linear-gradient(90deg,var(--pink),var(--pink-2));border:0;padding:8px 12px;border-radius:999px;font-weight:800;cursor:pointer;box-shadow:var(--shadow)}

    .wrap{max-width:1200px;margin:120px auto 60px;padding:0 18px}
    .topbar{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:18px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:66px;height:66px;border-radius:14px;background:linear-gradient(135deg,var(--rose),var(--pink));display:flex;align-items:center;justify-content:center;color:white;font-weight:900;box-shadow:0 12px 40px rgba(255,107,138,0.12)}
    .brand h1{margin:0;font-size:20px}
    .muted{color:var(--muted)}

    #topClock{background:linear-gradient(90deg,var(--pink),var(--pink-2));padding:10px 16px;border-radius:999px;color:#410622;font-weight:900;box-shadow:var(--shadow)}

    /* ---------- Layout ---------- */
    .content{display:grid;grid-template-columns:1fr 360px;gap:18px}
    .card{background:var(--panel);border-radius:14px;padding:16px;border:1px solid rgba(0,0,0,0.03);box-shadow:var(--shadow)}
    h2{margin:0 0 8px 0}

    /* pages */
    .page{display:none}
    .page.active{display:block}

    /* gallery */
    .gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px;margin-top:12px}
    .slot{height:120px;border-radius:10px;background:linear-gradient(180deg,#fff,#fff0f6);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;border:1px dashed rgba(255,107,138,0.12)}
    .slot img{width:100%;height:100%;object-fit:cover}
    .caption{position:absolute;left:6px;right:6px;bottom:6px;background:rgba(255,255,255,0.9);padding:6px;border-radius:8px;font-weight:800;text-align:center;color:#422033}

    /* clocks */
    #bigClock{font-weight:900;color:#6b2640;text-align:center;padding:18px;border-radius:12px;background:linear-gradient(90deg,rgba(255,214,231,0.5),rgba(255,245,249,0.2));font-size:18px}
    #sideClock{font-weight:800;color:#6b2640}

    /* timeline */
    .timeline{display:flex;flex-direction:column;gap:10px;margin-top:12px}
    .moment{display:flex;gap:10px;align-items:center}
    .moment img{width:96px;height:64px;object-fit:cover;border-radius:8px}

    /* login overlay */
    #overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(255,245,248,0.98),rgba(255,240,246,0.98));z-index:999}
    .login{width:92%;max-width:820px;background:linear-gradient(180deg,#fff,#fff0f6);border-radius:18px;padding:22px;position:relative;box-shadow:0 30px 80px rgba(201,80,120,0.12)}
    .login h3{margin:0;color:var(--rose)}
    .login .hint{color:var(--muted);margin-top:6px}
    .login .row{display:flex;gap:10px;margin-top:14px}
    .login input[type=text]{flex:1;padding:12px;border-radius:12px;border:1px solid rgba(0,0,0,0.04);font-weight:800}
    .login .enter{background:linear-gradient(90deg,var(--rose),var(--pink));color:white;border:0;padding:12px 16px;border-radius:12px;font-weight:900;cursor:pointer}
    canvas#hearts{position:absolute;inset:0;pointer-events:none}

    /* secret modal */
    #secret{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);z-index:1200}
    .secretCard{width:92%;max-width:520px}

    /* personalization */
    .small{padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.04);background:transparent}

    footer{margin-top:20px;text-align:center;color:var(--muted)}

    @media(max-width:980px){.content{grid-template-columns:1fr}.nav{overflow:auto}}
  </style>
</head>
<body>
<!-- ---------- LOGIN OVERLAY ---------- -->
<div id="overlay">
  <canvas id="hearts"></canvas>
  <div class="login card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <h3>Eu te amo, amor da minha vida...</h3>
        <div class="hint">Dica: <strong>Uma data especial</strong></div>
      </div>
      <div class="muted">Entrada segura</div>
    </div>
    <div class="row">
      <input id="loginInput" type="text" placeholder="Senha" aria-label="senha" />
      <button id="enterBtn" class="enter">Entrar</button>
    </div>
    <div style="margin-top:12px;display:flex;gap:10px;align-items:center">
      <input id="loginPhoto" type="file" accept="image/*" />
      <div class="muted">(opcional) envie uma foto nossa ‚Äî aparece na galeria</div>
    </div>
    <div id="miniPreview" style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap"></div>
  </div>
</div>

<!-- ---------- NAV & HEADER ---------- -->
<header>
  <div class="nav">
    <button data-route="home">In√≠cio</button>
    <button data-route="momentos">Nossos Momentos</button>
    <button data-route="cartas">Cartas</button>
    <button data-route="historia">Nossa Hist√≥ria</button>
  </div>
</header>

<div class="wrap">
  <div class="topbar">
    <div class="brand">
      <div class="logo" id="logoText">J‚ù§V</div>
      <div>
        <h1 id="brandTitle">Josias & Vit√≥ria</h1>
        <div class="muted">Come√ßamos: <span id="startDate">2025-09-18</span></div>
      </div>
    </div>
    <div id="topClock">Carregando...</div>
  </div>

  <div class="content">
    <div>
      <!-- HOME -->
      <section id="home" class="page card active">
        <h2>In√≠cio</h2>
        <div id="bigClock"></div>
        <p class="muted">Cada segundo ao teu lado √© o mais bonito da minha vida üíû</p>

        <div class="card" style="margin-top:12px">
          <h3>Galeria R√°pida</h3>
          <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
            <input id="addFiles" type="file" accept="image/*" multiple style="display:none" />
            <button id="addBtn" class="small">Adicionar fotos</button>
            <button id="clearBtn" class="small">Limpar galeria</button>
            <div style="margin-left:auto" class="muted">Clique na legenda para editar</div>
          </div>
          <div class="gallery" id="gallery"></div>
        </div>
      </section>

      <!-- MOMENTOS -->
      <section id="momentos" class="page card">
        <h2>Nossos Momentos</h2>
        <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
          <input id="momTitle" placeholder="T√≠tulo" class="small" />
          <input id="momDate" type="date" class="small" />
          <input id="momFile" type="file" accept="image/*" />
          <button id="addMoment" class="small">Adicionar</button>
        </div>
        <div class="timeline" id="timeline"></div>
      </section>

      <!-- CARTAS -->
      <section id="cartas" class="page card">
        <h2>Cartas & Textos</h2>
        <textarea id="letterText" placeholder="Escreva algo fofo..." style="min-height:120px;margin-top:8px" class="small"></textarea>
        <div style="display:flex;gap:8px;margin-top:8px"><input id="letterTitle" placeholder="T√≠tulo" class="small" /><button id="saveLetter" class="small">Salvar</button></div>
        <div id="letters" style="margin-top:12px"></div>
      </section>

      <!-- HIST√ìRIA -->
      <section id="historia" class="page card">
        <h2>Nossa Hist√≥ria</h2>
        <p class="muted">Linha do tempo edit√°vel ‚Äî adicione eventos importantes.</p>
        <div id="story" style="margin-top:12px"></div>
      </section>
    </div>

    <!-- SIDEBAR -->
    <aside>
      <div class="card">
        <h3>Rel√≥gio do Amor</h3>
        <div id="sideClock"></div>
        <div class="muted" style="margin-top:8px">Dias ‚Ä¢ hh:mm:ss.mmm</div>
      </div>

      <div class="card" style="margin-top:12px">
        <h3>Coisinhas Divertidas</h3>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
          <button id="phraseBtn" class="small">Frase rom√¢ntica</button>
          <button id="emojiBtn" class="small">Chuva de cora√ß√µes</button>
          <button id="secretBtn" class="small">Cantinho Secreto</button>
        </div>
        <div id="funBox" style="margin-top:12px"></div>
      </div>

      <div class="card" style="margin-top:12px">
        <h3>Personalizar</h3>
        <label class="muted">M√∫sica de fundo (URL mp3)</label>
        <input id="musicUrl" placeholder="Cole a URL aqui" class="small" />
        <div style="display:flex;gap:8px;margin-top:8px"><button id="playMusic" class="small">Tocar</button><button id="stopMusic" class="small">Parar</button></div>
        <div style="display:flex;gap:8px;margin-top:10px"><button id="saveAll" class="small">Salvar</button><button id="exportBtn" class="small">Exportar</button><button id="importBtn" class="small">Importar</button></div>
        <input id="importFile" type="file" accept="application/json" style="display:none" />
      </div>
    </aside>
  </div>

  <footer><div class="muted">Feito com morango e amor üçì‚ù§Ô∏è ‚Äî Edite com carinho</div></footer>
</div>

<!-- SECRET MODAL -->
<div id="secret"><div class="secretCard card"><h3>Cantinho da Safadeza</h3><input id="secretInput" placeholder="Senha" class="small" style="margin-top:8px" /><div style="display:flex;gap:8px;margin-top:8px"><button id="secretEnter" class="small">Entrar</button><button id="secretClose" class="small">Fechar</button></div><div class="muted" style="margin-top:8px">Senha: <em>princesa linda</em></div><div id="secretArea" style="margin-top:12px;display:none"><textarea id="secretNote" class="small" placeholder="Escreva algo s√≥ pra n√≥s..." style="min-height:140px"></textarea><div style="display:flex;gap:8px;margin-top:8px"><button id="saveSecret" class="small">Salvar</button></div></div></div></div>

<script>
  // ---------- Constants & storage ----------
  const STORAGE_KEY = 'portal_fofo_obraprima_v1';
  const START_ISO = '2025-09-18T00:00:00-03:00';
  const LOGIN_PASS = '180925'; // as requested (only digits)
  const SECRET_PASS = 'princesa linda';

  const defaults = () => ({ photos: Array(12).fill(null), letters: [], moments: [], story:[{id:Date.now(),date:'2025-09-18',title:'Come√ßamos',desc:'O dia que mudamos tudo.'}], secretNotes:[], settings:{music:''} });
  let DATA = JSON.parse(localStorage.getItem(STORAGE_KEY) || JSON.stringify(defaults()));
  function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(DATA)); }
  function $id(id){ return document.getElementById(id); }
  function escapeHtml(s){ if(!s) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  // ---------- Heart animation (overlay) ----------
  const heartCanvas = $id('hearts'); const hctx = heartCanvas.getContext('2d'); let hearts=[];
  function resizeCanvas(){ heartCanvas.width = window.innerWidth; heartCanvas.height = window.innerHeight; }
  window.addEventListener('resize', resizeCanvas); resizeCanvas();
  function spawn(){ hearts.push({x:Math.random()*heartCanvas.width, y:-20, size:6+Math.random()*12, vy:0.6+Math.random()*1.2, life:0, hue: 330+Math.random()*20}); if(hearts.length>140) hearts.shift(); }
  setInterval(spawn,220);
  function drawHearts(){ hctx.clearRect(0,0,heartCanvas.width,heartCanvas.height); hearts.forEach(h=>{ h.y += h.vy; h.life += 0.01; hctx.beginPath(); const g = hctx.createRadialGradient(h.x,h.y,0,h.x,h.y,h.size*3); g.addColorStop(0,'rgba(255,255,255,0.9)'); g.addColorStop(0.2,`hsla(${h.hue},85%,65%,0.95)`); g.addColorStop(1,'rgba(255,255,255,0)'); hctx.fillStyle = g; hctx.arc(h.x,h.y,h.size,0,Math.PI*2); hctx.fill(); }); requestAnimationFrame(drawHearts); }
  drawHearts();

  // ---------- Login logic ----------
  $id('enterBtn').addEventListener('click', doLogin);
  $id('loginInput').addEventListener('keydown', e=>{ if(e.key==='Enter') doLogin(); });
  function doLogin(){ const v = $id('loginInput').value.trim(); if(v === LOGIN_PASS){ // success
      document.getElementById('overlay').style.transition='opacity .45s ease'; document.getElementById('overlay').style.opacity='0'; setTimeout(()=>{ document.getElementById('overlay').style.display='none'; initApp(); },500);
    } else { alert('Senha incorreta üíî ‚Äî lembra da data especial.'); } }

  // allow preview photo before login
  $id('loginPhoto').addEventListener('change', e=>{ const f = e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=ev=>{ let pos = DATA.photos.findIndex(x=>!x || !x.data); pos = pos===-1?DATA.photos.length:pos; DATA.photos[pos] = {id:Date.now()+Math.random(), data:ev.target.result, caption:'(editar)'}; save(); renderMiniPreview(); }; r.readAsDataURL(f); });

  function renderMiniPreview(){ const box = $id('miniPreview'); box.innerHTML=''; DATA.photos.slice(0,6).forEach((p,i)=>{ const d = document.createElement('div'); d.style.width='80px'; d.style.height='80px'; d.style.borderRadius='8px'; d.style.overflow='hidden'; d.style.border='1px solid rgba(0,0,0,0.04)'; d.style.position='relative'; if(p && p.data){ d.innerHTML = `<img src='${p.data}' style='width:100%;height:100%;object-fit:cover'><div contenteditable data-mini='${i}' style='position:absolute;left:6px;right:6px;bottom:6px;background:rgba(255,255,255,0.85);padding:4px;border-radius:6px;font-size:12px;text-align:center'>${escapeHtml(p.caption||'(editar)')}</div>`; } else { d.innerHTML = `<div style='display:flex;align-items:center;justify-content:center;height:100%;color:var(--muted)'>+</div>`; } box.appendChild(d); });
    box.querySelectorAll('[data-mini]').forEach(node=>node.addEventListener('blur', ()=>{ const i=parseInt(node.dataset.mini); if(!DATA.photos[i]) DATA.photos[i]={id:Date.now()+Math.random(),data:null,caption:node.innerText}; else DATA.photos[i].caption = node.innerText; save(); renderGallery(); })); }

  // ---------- Clocks ----------
  function updateClocks(){ const now = Date.now(); let diff = now - new Date(START_ISO).getTime(); const days = Math.floor(diff/86400000); diff%=86400000; const hh = Math.floor(diff/3600000); diff%=3600000; const mm = Math.floor(diff/60000); diff%=60000; const ss = Math.floor(diff/1000); const ms = diff%1000; $id('topClock').innerText = `${days}d ${String(hh).padStart(2,'0')}:${String(mm).padStart(2,'0')}:${String(ss).padStart(2,'0')}.${String(ms).padStart(3,'0')} desde 18/09/2025 ‚ù§Ô∏è`; $id('bigClock').innerText = `${days} dias ‚Ä¢ ${String(hh).padStart(2,'0')}h : ${String(mm).padStart(2,'0')}m : ${String(ss).padStart(2,'0')}s : ${String(ms).padStart(3,'0')}ms`; $id('sideClock').innerText = `${days}d ${String(hh).padStart(2,'0')}:${String(mm).padStart(2,'0')}:${String(ss).padStart(2,'0')}`; }
  setInterval(updateClocks,33); updateClocks();

  // ---------- Navigation (SPA) ----------
  document.querySelectorAll('header .nav button').forEach(b=>b.addEventListener('click', ()=>{ const route = b.dataset.route; navigate(route); }));
  function navigate(route){ if(!route) route='home'; document.querySelectorAll('.page').forEach(p=>p.classList.remove('active')); const el = $id(route); if(el) el.classList.add('active'); window.scrollTo({top:0,behavior:'smooth'}); }

  // ---------- Gallery ----------
  function renderGallery(){ const g = $id('gallery'); g.innerHTML=''; DATA.photos.forEach((p,i)=>{ const slot = document.createElement('div'); slot.className='slot'; slot.dataset.i = i; if(p && p.data){ slot.innerHTML = `<img src='${p.data}' alt='photo'><div class='caption' contenteditable data-cap='${i}'>${escapeHtml(p.caption||'(editar)')}</div><div style='position:absolute;top:6px;right:6px'><button data-del='${i}' class='small'>Excluir</button></div>`; } else { slot.innerHTML = `<div class='muted'>Vazio</div><div style='margin-top:6px'><button data-add='${i}' class='small'>Adicionar</button></div><div class='caption' contenteditable data-cap='${i}' style='opacity:0.7'>(editar)</div>`; } g.appendChild(slot); });
    g.querySelectorAll('[data-add]').forEach(b=>b.addEventListener('click', e=>{ const idx = parseInt(b.dataset.add); $id('addFiles').click(); $id('addFiles').dataset.target = idx; }));
    g.querySelectorAll('[data-del]').forEach(b=>b.addEventListener('click', e=>{ const idx = parseInt(b.dataset.del); if(confirm('Excluir foto?')){ DATA.photos[idx]=null; save(); renderGallery(); renderMiniPreview(); } }));
    g.querySelectorAll('[data-cap]').forEach(node=>node.addEventListener('blur', ()=>{ const i=parseInt(node.dataset.cap); if(!DATA.photos[i]) DATA.photos[i] = {id:Date.now()+Math.random(),data:null,caption:node.innerText}; else DATA.photos[i].caption = node.innerText; save(); })); }

  $id('addBtn').addEventListener('click', ()=>$id('addFiles').click());
  $id('addFiles').addEventListener('change', e=>{ const files = Array.from(e.target.files); const target = e.target.dataset.target !== undefined ? parseInt(e.target.dataset.target) : null; files.forEach(f=>{ const r=new FileReader(); r.onload=ev=>{ if(target!==null){ DATA.photos[target] = {id:Date.now()+Math.random(),data:ev.target.result,caption:'(editar)'}; } else { let pos = DATA.photos.findIndex(x=>!x || !x.data); pos = pos===-1?DATA.photos.length:pos; DATA.photos[pos] = {id:Date.now()+Math.random(),data:ev.target.result,caption:'(editar)'}; } save(); renderGallery(); renderMiniPreview(); }; r.readAsDataURL(f); }); e.target.value=''; });

  $id('clearBtn').addEventListener('click', ()=>{ if(confirm('Limpar todas as fotos?')){ DATA.photos = Array(12).fill(null); save(); renderGallery(); renderMiniPreview(); } });

  // ---------- Letters ----------
  $id('saveLetter').addEventListener('click', ()=>{ const t = $id('letterTitle').value || 'Carta'; const b = $id('letterText').value || ''; DATA.letters.unshift({id:Date.now()+Math.random(),title:t,body:b,created:new Date().toISOString()}); save(); renderLetters(); $id('letterText').value=''; $id('letterTitle').value=''; });
  function renderLetters(){ const box = $id('letters'); box.innerHTML=''; DATA.letters.forEach(l=>{ const d=document.createElement('div'); d.className='card'; d.style.padding='10px'; d.innerHTML = `<div style='display:flex;justify-content:space-between;align-items:center'><strong>${escapeHtml(l.title)}</strong><small class='muted'>${new Date(l.created).toLocaleString()}</small></div><p style='margin-top:8px'>${escapeHtml(l.body).replace(/\n/g,'<br>')}</p>`; box.appendChild(d); }); }

  // ---------- Moments / timeline ----------
  $id('addMoment').addEventListener('click', ()=>{ const t = $id('momTitle').value || 'Momento'; const d = $id('momDate').value || new Date().toISOString().slice(0,10); const f = $id('momFile').files[0]; if(f){ const r=new FileReader(); r.onload=ev=>{ DATA.moments.unshift({id:Date.now()+Math.random(),title:t,date:d,photo:ev.target.result,desc:''}); save(); renderTimeline(); }; r.readAsDataURL(f); } else { DATA.moments.unshift({id:Date.now()+Math.random(),title:t,date:d,photo:null,desc:''}); save(); renderTimeline(); } $id('momTitle').value=''; $id('momDate').value=''; $id('momFile').value=''; });
  function renderTimeline(){ const box = $id('timeline'); box.innerHTML=''; DATA.moments.forEach(m=>{ const d = document.createElement('div'); d.className='moment card'; d.style.padding='8px'; d.innerHTML = `${m.photo?`<img src='${m.photo}'>`:''}<div style='flex:1'><div contenteditable data-mid='${m.id}' style='font-weight:800'>${escapeHtml(m.title)}</div><div class='muted'>${m.date}</div><div contenteditable data-mdesc='${m.id}' style='margin-top:6px'>${escapeHtml(m.desc||'Clique para adicionar descri√ß√£o')}</div></div>`; box.appendChild(d); });
    box.querySelectorAll('[data-mid]').forEach(node=>node.addEventListener('blur', ()=>{ const id=parseFloat(node.dataset.mid); const mm = DATA.moments.find(x=>x.id===id); if(mm) mm.title = node.innerText; save(); }));
    box.querySelectorAll('[data-mdesc]').forEach(node=>node.addEventListener('blur', ()=>{ const id=parseFloat(node.dataset.mdesc); const mm = DATA.moments.find(x=>x.id===id); if(mm) mm.desc = node.innerText; save(); })); }

  // ---------- Story ----------
  function renderStory(){ const box = $id('story'); box.innerHTML=''; DATA.story.forEach(s=>{ const d=document.createElement('div'); d.className='card'; d.style.padding='10px'; d.innerHTML = `<div style='display:flex;justify-content:space-between;align-items:center'><strong contenteditable data-sid='${s.id}'>${escapeHtml(s.title)}</strong><small class='muted'>${s.date}</small></div><p contenteditable data-sdesc='${s.id}' style='margin-top:8px'>${escapeHtml(s.desc)}</p>`; box.appendChild(d); });
    box.querySelectorAll('[data-sid]').forEach(n=>n.addEventListener('blur', ()=>{ const id=parseFloat(n.dataset.sid); const st = DATA.story.find(x=>x.id===id); if(st) st.title = n.innerText; save(); }));
    box.querySelectorAll('[data-sdesc]').forEach(n=>n.addEventListener('blur', ()=>{ const id=parseFloat(n.dataset.sdesc); const st = DATA.story.find(x=>x.id===id); if(st) st.desc = n.innerText; save(); })); }

  // ---------- Fun ----------
  $id('phraseBtn').addEventListener('click', ()=>{ const arr=['Te amo mais que ontem e menos que amanh√£','Voc√™ √© meu melhor sonho','Seu sorriso √© meu lugar favorito','Pra sempre n√≥s dois']; $id('funBox').innerText = arr[Math.floor(Math.random()*arr.length)]; });
  $id('emojiBtn').addEventListener('click', ()=>{ for(let i=0;i<30;i++){ setTimeout(()=>{ const e=document.createElement('div'); e.style.position='fixed'; e.style.left=Math.random()*100+'%'; e.style.top='-30px'; e.style.fontSize='22px'; e.style.zIndex=999; e.innerText = ['üíñ','üçì','üòò','üå∏'][Math.floor(Math.random()*4)]; document.body.appendChild(e); e.animate([{transform:'translateY(0)',opacity:1},{transform:`translateY(${window.innerHeight+50}px)`,opacity:0}],{duration:3000+Math.random()*2000,iterations:1}); setTimeout(()=>e.remove(),4200); }, i*60); } });

  // ---------- Secret ----------
  $id('secretBtn').addEventListener('click', ()=>{ $id('secret').style.display='flex'; $id('secret').querySelector('.secretCard').style.display='block'; });
  $id('secretClose').addEventListener('click', ()=>{ $id('secret').style.display='none'; });
  $id('secretEnter').addEventListener('click', ()=>{ const v = $id('secretInput').value.trim().toLowerCase(); if(v === SECRET_PASS){ $id('secretArea').style.display='block'; } else alert('Senha secreta errada üíã'); });
  $id('saveSecret').addEventListener('click', ()=>{ const t = $id('secretNote').value||''; DATA.secretNotes.unshift({id:Date.now()+Math.random(),text:t,created:new Date().toISOString()}); save(); alert('Guardado üíñ'); $id('secretNote').value=''; });

  // ---------- Music ----------
  let audio = null; $id('playMusic').addEventListener('click', ()=>{ const url = $id('musicUrl').value.trim(); if(!url) return alert('Cole a URL do mp3'); if(audio){ audio.pause(); audio=null; } audio = new Audio(url); audio.loop=true; audio.play(); DATA.settings.music = url; save(); });
  $id('stopMusic').addEventListener('click', ()=>{ if(audio){ audio.pause(); audio=null; } });

  // ---------- Export / Import ----------
  $id('exportBtn').addEventListener('click', ()=>{ const blob = new Blob([JSON.stringify(DATA,null,2)],{type:'application/json'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='backup_portal_fofo.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); });
  $id('importBtn').addEventListener('click', ()=>{ $id('importFile').click(); });
  $id('importFile').addEventListener('change', e=>{ const f = e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=ev=>{ try{ const parsed = JSON.parse(ev.target.result); DATA = parsed; save(); renderGallery(); renderMiniPreview(); renderLetters(); renderTimeline(); renderStory(); alert('Backup importado!'); }catch(err){ alert('Arquivo inv√°lido'); } }; r.readAsText(f); });

  // ---------- Init & safety ----------
  function initApp(){ // render all
    if(!Array.isArray(DATA.photos)) DATA.photos = Array(12).fill(null);
    while(DATA.photos.length<12) DATA.photos.push(null);
    renderGallery(); renderMiniPreview(); renderLetters(); renderTimeline(); renderStory(); navigate('home');
  }

  // initial preview so login feels alive
  renderMiniPreview(); renderGallery(); renderLetters(); renderTimeline(); renderStory();

  // keyboard save
  window.addEventListener('keydown', e=>{ if((e.ctrlKey||e.metaKey) && e.key==='s'){ e.preventDefault(); save(); alert('Salvo!'); } });

</script>
</body>
</html>