<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Nosso Cantinho ‚Äî Josias & Vit√≥ria</title>
<meta name="description" content="Portal fofo, interativo e edit√°vel para celebrar nosso namoro." />
<style>
  /* ================== THEME (strawberry pastel) ================== */
  :root{
    --page-bg: #fff7fb;
    --panel: #ffffff;
    --pink-1: #ff6b97;
    --pink-2: #ffd3e8;
    --accent: #ff4d88;
    --muted: #9aa4b8;
    --shadow: 0 12px 40px rgba(107,34,64,0.08);
    --glass: rgba(255,255,255,0.7);
    --radius: 14px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui, -apple-system, 'Segoe UI', Roboto, Arial;color:#3b2430;background:linear-gradient(180deg,var(--page-bg), #fff0f6);-webkit-font-smoothing:antialiased}
  a{color:inherit}
  button{font-family:inherit}

  /* Header / top nav */
  header{position:fixed;left:0;right:0;top:12px;display:flex;justify-content:center;z-index:120}
  .nav{display:flex;gap:10px;padding:8px;border-radius:999px;background:transparent}
  .nav .btn{
    background:linear-gradient(90deg,var(--pink-1),var(--pink-2));
    border:0;padding:10px 14px;border-radius:999px;font-weight:800;cursor:pointer;color:#2b1020;box-shadow:var(--shadow);
    display:inline-flex;align-items:center;gap:8px;
  }
  .nav .btn.active{outline:3px solid rgba(0,0,0,0.85);transform:translateY(-2px)}
  .nav .icon{width:18px;height:18px;display:inline-block;flex:0 0 18px}

  /* container */
  .wrap{max-width:1200px;margin:110px auto 60px;padding:0 18px}
  .topbar{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:16px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{
    width:64px;height:64px;border-radius:14px;background:linear-gradient(135deg,var(--accent),var(--pink-2));
    display:flex;align-items:center;justify-content:center;color:white;font-weight:900;box-shadow:var(--shadow);font-size:20px;
  }
  .brand .title{font-size:18px;font-weight:900}
  .brand .sub{color:var(--muted);font-size:13px}

  #topClock{background:linear-gradient(90deg,var(--pink-1),var(--pink-2));padding:10px 16px;border-radius:999px;font-weight:900;color:#300817;box-shadow:var(--shadow)}

  /* layout */
  .layout{display:grid;grid-template-columns:1fr 360px;gap:18px;align-items:start}
  .card{background:var(--panel);border-radius:var(--radius);padding:14px;border:1px solid rgba(0,0,0,0.03);box-shadow:var(--shadow)}
  h2{margin:0 0 8px 0}

  /* pages */
  .page{display:none}
  .page.active{display:block}

  /* big clock */
  #bigClock{font-weight:900;color:#6b2640;text-align:center;padding:18px;border-radius:12px;background:linear-gradient(90deg,rgba(255,225,235,0.6),rgba(255,245,249,0.2));font-size:18px}

  /* GALLERY (unlimited) */
  .controls{display:flex;gap:8px;align-items:center}
  .small-btn{background:transparent;border:1px solid rgba(0,0,0,0.06);padding:8px 10px;border-radius:10px;cursor:pointer}
  .gallery-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px;margin-top:12px}
  .photo-card{background:linear-gradient(180deg,#fff,#fff7fb);border-radius:12px;overflow:hidden;position:relative;border:1px solid rgba(0,0,0,0.03)}
  .photo-card img{width:100%;height:140px;object-fit:cover;display:block}
  .photo-meta{padding:8px;display:flex;flex-direction:column;gap:6px}
  .meta-row{display:flex;gap:8px;align-items:center}
  .meta-row input[type="date"], .meta-row input[type="text"]{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.05);background:transparent}
  .meta-actions{display:flex;gap:6px}
  .pill{padding:6px 8px;border-radius:999px;background:linear-gradient(90deg,var(--pink-2),#fff);font-weight:700}

  /* diary & channels */
  .channel-list{display:flex;flex-direction:column;gap:10px;margin-top:12px}
  .entry{padding:10px;border-radius:10px;background:linear-gradient(180deg,#fff,#fff7fb);border:1px solid rgba(0,0,0,0.03)}
  .entry time{font-size:12px;color:var(--muted)}
  textarea{width:100%;min-height:100px;padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);resize:vertical;background:transparent}

  /* sidebar */
  aside .card + .card{margin-top:12px}

  /* footer */
  footer{margin-top:18px;text-align:center;color:var(--muted)}

  /* hearts & strawberry decorations */
  .cute-row{display:flex;align-items:center;gap:8px}
  .straw{width:22px;height:22px;border-radius:6px;background:linear-gradient(90deg,#ff9ab8,#ffd3e8);display:inline-flex;align-items:center;justify-content:center;font-weight:900;color:#60061a}

  /* responsive */
  @media(max-width:980px){
    .layout{grid-template-columns:1fr}
    header{position:static;padding:10px 0;display:block;text-align:center}
    .wrap{margin-top:20px}
    .nav{overflow:auto;justify-content:center;padding:8px 6px}
  }
</style>
</head>
<body>
  <!-- ================== LOGIN OVERLAY ================== -->
  <div id="overlay" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(255,245,248,0.98),rgba(255,240,246,0.98));z-index:999">
    <canvas id="hearts" style="position:absolute;inset:0;pointer-events:none"></canvas>
    <div style="width:92%;max-width:760px;border-radius:16px;background:linear-gradient(180deg,#fff,#fff7fb);padding:20px;box-shadow:0 30px 70px rgba(255,90,135,0.08);position:relative">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-size:20px;font-weight:900;color:var(--accent)">Eu te amo, amor da minha vida...</div>
          <div style="color:var(--muted);margin-top:6px">Dica: <strong>Uma data especial</strong></div>
        </div>
        <div style="color:var(--muted)">Entrada segura</div>
      </div>

      <div style="display:flex;gap:10px;margin-top:14px">
        <input id="loginInput" placeholder="Senha" style="flex:1;padding:12px;border-radius:12px;border:1px solid rgba(0,0,0,0.04);font-weight:800" />
        <button id="enterBtn" style="background:linear-gradient(90deg,var(--accent),var(--pink-2));color:#fff;border:0;padding:12px 16px;border-radius:12px;font-weight:900;cursor:pointer">Entrar</button>
      </div>

      <div style="margin-top:12px;display:flex;gap:10px;align-items:center">
        <input id="loginPhoto" type="file" accept="image/*" />
        <div style="color:var(--muted)">(opcional) envie uma foto ‚Äî ela aparece na galeria</div>
      </div>

      <div id="miniPreview" style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap"></div>
    </div>
  </div>

  <!-- ================== NAV ================== -->
  <header>
    <div class="nav" id="mainNav" role="navigation" aria-label="Menu">
      <button class="btn nav-btn" data-route="home"><span class="icon">üè†</span>In√≠cio</button>
      <button class="btn nav-btn" data-route="gallery"><span class="icon">üì∏</span>Nossa Galeria</button>
      <button class="btn nav-btn" data-route="diary"><span class="icon">üìì</span>Di√°rio</button>
      <button class="btn nav-btn" data-route="feelings"><span class="icon">üí¨</span>Sentimentos</button>
      <button class="btn nav-btn" data-route="complaints"><span class="icon">üìù</span>Desabafos</button>
      <button class="btn nav-btn" data-route="about"><span class="icon">üë©‚Äç‚ù§Ô∏è‚Äçüë®</span>Sobre N√≥s</button>
      <button class="btn nav-btn" data-route="personalize"><span class="icon">üéµ</span>Personalizar</button>
      <button class="btn nav-btn" data-route="surprise"><span class="icon">‚ú®</span>Surpresa</button>
    </div>
  </header>

  <!-- ================== MAIN ================== -->
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo">üçì</div>
        <div>
          <div class="title" contenteditable id="brandTitle">Josias & Vit√≥ria</div>
          <div class="sub">Come√ßamos: <span id="startDate">2025-09-18</span></div>
        </div>
      </div>
      <div id="topClock">Carregando...</div>
    </div>

    <div class="layout">
      <!-- LEFT: pages -->
      <div>
        <!-- HOME -->
        <section id="home" class="page card active">
          <h2>In√≠cio</h2>
          <div id="bigClock" style="margin-top:8px"></div>
          <p style="color:var(--muted);margin-top:8px">Cada segundo ao teu lado √© o mais bonito da minha vida üíû</p>

          <div class="card" style="margin-top:12px">
            <div style="display:flex;align-items:center;justify-content:space-between">
              <h3 style="margin:0">Galeria r√°pida</h3>
              <div class="cute-row"><div class="straw">J‚ù§V</div><div style="color:var(--muted);font-size:13px">Toque para ampliar</div></div>
            </div>

            <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
              <input id="addFiles" type="file" accept="image/*" multiple style="display:none" />
              <button id="addBtn" class="small-btn">‚ûï Adicionar</button>
              <button id="clearBtn" class="small-btn">üßπ Limpar</button>
              <button id="importPhotosBtn" class="small-btn">üìÅ Importar</button>
              <div style="margin-left:auto;color:var(--muted);font-size:13px">Todas as fotos guardadas aqui</div>
            </div>

            <div class="gallery-grid" id="galleryGrid" style="margin-top:12px"></div>
            <div style="margin-top:10px;color:var(--muted);font-size:13px">Use arrastar e soltar (drag & drop) para enviar fotos tamb√©m.</div>
          </div>
        </section>

        <!-- GALLERY (detailed unlimited) -->
        <section id="gallery" class="page card">
          <h2>Nossa Galeria</h2>
          <p style="color:var(--muted)">Adicione quantas fotos quiser. Cada foto tem data e legenda ‚Äî toque para editar.</p>

          <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
            <input id="addFiles2" type="file" accept="image/*" multiple style="display:none" />
            <button id="addBtn2" class="small-btn">‚ûï Adicionar v√°rias</button>
            <button id="exportPhotos" class="small-btn">‚¨áÔ∏è Exportar fotos</button>
            <button id="filterToday" class="small-btn">Filtrar: Hoje</button>
            <button id="showAll" class="small-btn">Mostrar tudo</button>
          </div>

          <div id="galleryList" class="gallery-grid" style="margin-top:12px"></div>
        </section>

        <!-- DIARY -->
        <section id="diary" class="page card">
          <h2>Di√°rio</h2>
          <p style="color:var(--muted)">Escreva algo por dia: mem√≥rias, planos, recados.</p>
          <div style="display:flex;gap:8px;margin-top:8px">
            <input id="diaryDate" type="date" style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.04)"/>
            <button id="newDiary" class="small-btn">Nova entrada</button>
          </div>
          <div id="diaryList" class="channel-list"></div>
        </section>

        <!-- FEELINGS -->
        <section id="feelings" class="page card">
          <h2>O que eu sinto agora</h2>
          <p style="color:var(--muted)">Espa√ßo para voc√™ registrar no momento: emo√ß√£o curta, cor, e emoji.</p>
          <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
            <input id="feelEmotion" placeholder="Ex: apaixonado, orgulhoso..." style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.04)"/>
            <input id="feelColor" type="color" value="#ff6b97" style="width:44px;height:44px;border-radius:8px;border:0"/>
            <input id="feelEmoji" placeholder="Emoji" style="width:70px;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.04)"/>
            <button id="saveFeeling" class="small-btn">Salvar</button>
          </div>
          <div id="feelList" class="channel-list" style="margin-top:12px"></div>
        </section>

        <!-- COMPLAINTS -->
        <section id="complaints" class="page card">
          <h2>Canal de Desabafo (brincando)</h2>
          <p style="color:var(--muted)">Um lugar pra reclamar com leveza ‚Äî bom para liberar pequenas frustra√ß√µes sem briga. Voc√™ pode marcar como privada.</p>
          <textarea id="complaintText" placeholder="Hoje me chateei quando..."></textarea>
          <div style="display:flex;gap:8px;margin-top:8px">
            <label style="display:flex;align-items:center;gap:8px"><input id="complaintPrivate" type="checkbox"/> Privado</label>
            <button id="saveComplaint" class="small-btn">Enviar</button>
            <button id="clearComplaints" class="small-btn">Limpar tudo</button>
          </div>
          <div id="complaintList" class="channel-list" style="margin-top:12px"></div>
        </section>

        <!-- ABOUT -->
        <section id="about" class="page card">
          <h2>Sobre N√≥s</h2>
          <p contenteditable id="aboutText" style="padding:10px;border-radius:10px;border:1px dashed rgba(0,0,0,0.04);min-height:80px">
            Conte aqui a hist√≥ria do casal, h√°bitos, desejos, planos. Edit√°vel e salvo automaticamente.
          </p>
        </section>

        <!-- PERSONALIZE -->
        <section id="personalize" class="page card">
          <h2>Personalizar</h2>
          <p style="color:var(--muted)">Ajuste cores, m√∫sica e pequenas prefer√™ncias.</p>
          <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
            <label class="pill">Paleta:</label>
            <button id="palDefault" class="small-btn">Strawberry</button>
            <button id="palLilac" class="small-btn">Lil√°s</button>
            <button id="palWhite" class="small-btn">Claro</button>
          </div>

          <div style="margin-top:10px">
            <label class="muted">M√∫sica de fundo (URL mp3)</label>
            <input id="musicUrl" placeholder="Cole a URL do mp3" style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.04)"/>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button id="playMusic" class="small-btn">‚ñ∂Ô∏è Tocar</button>
              <button id="stopMusic" class="small-btn">‚è∏ Parar</button>
              <button id="muteToggle" class="small-btn">üîá Mudo</button>
            </div>
          </div>

          <div style="margin-top:12px;display:flex;gap:8px">
            <button id="saveAll" class="small-btn">Salvar tudo</button>
            <button id="exportBtn" class="small-btn">Exportar backup</button>
            <button id="importBtn" class="small-btn">Importar backup</button>
            <input id="importFile" type="file" accept="application/json" style="display:none"/>
          </div>
        </section>

        <!-- SURPRISE -->
        <section id="surprise" class="page card">
          <h2>Surpresa</h2>
          <p style="color:var(--muted)">Efeitos, frases, e pequenos mimos a qualquer momento.</p>
          <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
            <button id="rainHearts" class="small-btn">üåß Chuva de cora√ß√µes</button>
            <button id="randomPhrase" class="small-btn">üíå Frase Aleat√≥ria</button>
            <button id="sparkle" class="small-btn">‚ú® Brilho</button>
          </div>
          <div id="surpriseBox" style="margin-top:12px;color:var(--muted)"></div>
        </section>
      </div>

      <!-- RIGHT: sidebar -->
      <aside>
        <div class="card">
          <h3>Rel√≥gio do Amor</h3>
          <div id="sideClock" style="margin-top:6px;font-weight:900"></div>
          <div style="color:var(--muted);margin-top:8px">Dias ‚Ä¢ hh:mm:ss.mmm</div>
        </div>

        <div class="card">
          <h3>Atalhos</h3>
          <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
            <button data-nav="gallery" class="small-btn">Ir para Galeria</button>
            <button data-nav="diary" class="small-btn">Ir para Di√°rio</button>
            <button data-nav="feelings" class="small-btn">Sentimentos</button>
            <button data-nav="complaints" class="small-btn">Desabafos</button>
          </div>
        </div>

        <div class="card">
          <h3>Quick Frases</h3>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
            <button class="small-btn quick" data-text="Te amo mais que ontem e menos que amanh√£">Te amo</button>
            <button class="small-btn quick" data-text="Voc√™ √© meu lugar seguro">Meu lugar</button>
            <button class="small-btn quick" data-text="Sorria, voc√™ √© minha paz">Sorria</button>
          </div>
          <div id="quickBox" style="margin-top:12px;color:var(--muted)"></div>
        </div>
      </aside>
    </div>

    <footer><div style="color:var(--muted)">Feito com morango e amor üçì‚ù§Ô∏è ‚Äî tudo salvo localmente (Exportar para backup)</div></footer>
  </div>

<script>
/* ================== CONFIG & STORAGE ================== */
const STORAGE_KEY = 'nosso_cantinho_v2';
const LOGIN_PASS = '180925'; // senha
const START_ISO = '2025-09-18T00:00:00-03:00';

const defaults = () => ({
  photos: [],        // {id, dataUrl, caption, dateAdded}
  diary: [],         // {id, date, title, body}
  feelings: [],      // {id, created, emotion, color, emoji}
  complaints: [],    // {id, created, text, private}
  story: [{id:Date.now(),date:'2025-09-18',title:'Come√ßamos',desc:'O dia que tudo mudou.'}],
  about: 'Coloque aqui a hist√≥ria de voc√™s (editable)',
  settings: {music:'', mute:false, palette:'strawberry'}
});

let DATA = JSON.parse(localStorage.getItem(STORAGE_KEY) || JSON.stringify(defaults()));
function saveAll(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(DATA)); }

/* ================== UTIL ================== */
const $ = id => document.getElementById(id);
function uid(){ return Date.now().toString(36) + Math.random().toString(36).slice(2,8); }
function fmtDate(d){ const dt = new Date(d); return dt.toLocaleDateString(); }
function escapeHtml(s){ if(!s) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* ================== HEARTS (login) ================== */
const heartCanvas = $('hearts');
const hctx = heartCanvas.getContext?.('2d');
let hearts = [];
function resizeCanvas(){ if(!hctx) return; heartCanvas.width = window.innerWidth; heartCanvas.height = window.innerHeight; }
window.addEventListener('resize', resizeCanvas);
resizeCanvas();
function spawnHeart(){ hearts.push({x:Math.random()*heartCanvas.width, y:-30, r:6+Math.random()*12, vy:0.6+Math.random()*1.2, hue:320+Math.random()*40, life:0}); if(hearts.length>160) hearts.shift(); }
setInterval(spawnHeart,200);
function drawHearts(){
  if(!hctx) return;
  hctx.clearRect(0,0,heartCanvas.width,heartCanvas.height);
  hearts.forEach(h=>{
    h.y += h.vy; h.life += 0.01;
    const g = hctx.createRadialGradient(h.x,h.y,0,h.x,h.y,h.r*3);
    g.addColorStop(0,'rgba(255,255,255,0.95)');
    g.addColorStop(0.2, `hsla(${h.hue},85%,65%,${1-h.life})`);
    g.addColorStop(1,'rgba(255,255,255,0)');
    hctx.fillStyle = g;
    hctx.beginPath(); hctx.arc(h.x,h.y,h.r,0,Math.PI*2); hctx.fill();
  });
  requestAnimationFrame(drawHearts);
}
drawHearts();

/* ================== LOGIN ================== */
$('enterBtn').addEventListener('click', ()=>{ const v = $('loginInput').value.trim(); if(v === LOGIN_PASS){ $('overlay').style.transition='opacity .4s ease'; $('overlay').style.opacity='0'; setTimeout(()=>{$('overlay').style.display='none'; initApp();},420); } else alert('Senha incorreta ‚Äî lembra da data especial üíî'); });
$('loginInput').addEventListener('keydown', e=>{ if(e.key==='Enter') $('enterBtn').click(); });

$('loginPhoto').addEventListener('change', e=>{
  const f = e.target.files[0]; if(!f) return;
  const r = new FileReader(); r.onload = ev => {
    DATA.photos.unshift({id:uid(), dataUrl:ev.target.result, caption: '', dateAdded: (new Date()).toISOString().slice(0,10)});
    saveAll(); renderMiniPreview();
  }
  r.readAsDataURL(f);
});

/* ================== INITIAL RENDERS (preview) ================== */
function renderMiniPreview(){
  const box = $('miniPreview'); box.innerHTML = '';
  (DATA.photos.slice(0,6)).forEach((p,i)=>{
    const d = document.createElement('div');
    d.style.width='80px'; d.style.height='80px'; d.style.borderRadius='8px'; d.style.overflow='hidden'; d.style.position='relative';
    if(p && p.dataUrl) d.innerHTML = `<img src="${p.dataUrl}" style="width:100%;height:100%;object-fit:cover"><div contenteditable data-mini="${p.id}" style="position:absolute;left:6px;right:6px;bottom:6px;background:rgba(255,255,255,0.85);padding:4px;border-radius:6px;font-size:11px;text-align:center">${escapeHtml(p.caption||'')}</div>`;
    else d.innerHTML = `<div style="display:flex;align-items:center;justify-content:center;height:100%;color:var(--muted)">+</div>`;
    box.appendChild(d);
  });
  box.querySelectorAll('[data-mini]').forEach(node=>{
    node.addEventListener('blur', ()=>{
      const id = node.dataset.mini; const ph = DATA.photos.find(x=>x.id===id); if(ph){ ph.caption = node.innerText; saveAll(); renderGalleryGrid(); }
    });
  });
}

/* ================== CLOCKS ================== */
function updateClockDisplays(){
  const now = Date.now(); let diff = now - new Date(START_ISO).getTime();
  const days = Math.floor(diff/86400000); diff%=86400000;
  const hh = Math.floor(diff/3600000); diff%=3600000;
  const mm = Math.floor(diff/60000); diff%=60000;
  const ss = Math.floor(diff/1000); const ms = diff%1000;
  $('topClock').innerText = `${days}d ${String(hh).padStart(2,'0')}:${String(mm).padStart(2,'0')}:${String(ss).padStart(2,'0')}.${String(ms).padStart(3,'0')} desde 18/09/2025 ‚ù§Ô∏è`;
  $('bigClock').innerText = `${days} dias ‚Ä¢ ${String(hh).padStart(2,'0')}h : ${String(mm).padStart(2,'0')}m : ${String(ss).padStart(2,'0')}s : ${String(ms).padStart(3,'0')}ms`;
  $('sideClock').innerText = `${days}d ${String(hh).padStart(2,'0')}:${String(mm).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;
}
setInterval(updateClockDisplays,33); updateClockDisplays();

/* ================== NAVIGATION (SPA) ================== */
document.querySelectorAll('.nav-btn').forEach(btn=>{
  btn.addEventListener('click', e=>{
    document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const route = btn.dataset.route;
    showRoute(route);
  });
});
function showRoute(route){
  if(!route) route='home';
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  const el = $(route);
  if(el) el.classList.add('active');
  window.scrollTo({top:0,behavior:'smooth'});
}
/* set first active */
document.querySelectorAll('.nav-btn')[0].classList.add('active');

/* ================== GALLERY (unlimited) ================== */
function renderGalleryGrid(filterToday=false){
  const grid = $('galleryGrid'); grid.innerHTML='';
  const items = filterToday ? DATA.photos.filter(p=>p.dateAdded===new Date().toISOString().slice(0,10)) : DATA.photos;
  items.forEach(ph=>{
    const card = document.createElement('div'); card.className='photo-card';
    card.innerHTML = `
      <img src="${ph.dataUrl}" alt="photo">
      <div class="photo-meta">
        <div class="meta-row"><input type="text" data-cap="${ph.id}" placeholder="Legenda" value="${escapeHtml(ph.caption||'')}" /></div>
        <div class="meta-row"><input type="date" data-date="${ph.id}" value="${ph.dateAdded||new Date().toISOString().slice(0,10)}" /><div class="meta-actions"><button data-del="${ph.id}" class="small-btn">Excluir</button><button data-zoom="${ph.id}" class="small-btn">üîç Ampliar</button></div></div>
      </div>
    `;
    grid.appendChild(card);
  });

  // bindings
  grid.querySelectorAll('[data-cap]').forEach(inp=>{
    inp.addEventListener('change', e=>{
      const id = inp.dataset.cap; const ph = DATA.photos.find(x=>x.id===id); if(ph){ ph.caption = inp.value; saveAll(); }
    });
  });
  grid.querySelectorAll('[data-date]').forEach(inp=>{
    inp.addEventListener('change', e=>{
      const id = inp.dataset.date; const ph = DATA.photos.find(x=>x.id===id); if(ph){ ph.dateAdded = inp.value; saveAll(); }
    });
  });
  grid.querySelectorAll('[data-del]').forEach(b=>{
    b.addEventListener('click', ()=>{
      if(confirm('Remover foto?')){ const id = b.dataset.del; DATA.photos = DATA.photos.filter(x=>x.id!==id); saveAll(); renderGalleryGrid(); renderGalleryList(); renderMiniPreview(); }
    });
  });
  grid.querySelectorAll('[data-zoom]').forEach(b=>{
    b.addEventListener('click', ()=>{ const id = b.dataset.zoom; const ph = DATA.photos.find(x=>x.id===id); if(ph) openLightbox(ph); });
  });
}

function openLightbox(photo){
  const overlay = document.createElement('div');
  overlay.style.position='fixed'; overlay.style.inset=0; overlay.style.background='rgba(0,0,0,0.6)'; overlay.style.display='flex'; overlay.style.alignItems='center'; overlay.style.justifyContent='center'; overlay.style.zIndex=9999;
  const box = document.createElement('div'); box.style.maxWidth='90%'; box.style.maxHeight='90%'; box.style.borderRadius='12px'; box.style.overflow='hidden'; box.style.background='#fff';
  box.innerHTML = `<img src="${photo.dataUrl}" style="width:100%;height:auto;display:block" /><div style="padding:8px;display:flex;gap:8px;align-items:center"><div style="flex:1">${escapeHtml(photo.caption||'')}</div><div><button id="closeLb" style="padding:6px 8px;border-radius:8px">Fechar</button></div></div>`;
  overlay.appendChild(box); document.body.appendChild(overlay);
  overlay.querySelector('#closeLb').addEventListener('click', ()=>overlay.remove());
  overlay.addEventListener('click', (e)=>{ if(e.target===overlay) overlay.remove(); });
}

/* add photos function (files array) */
function addFilesToGallery(files){
  const fl = Array.from(files);
  let count = 0;
  fl.forEach(f=>{
    const r = new FileReader();
    r.onload = ev => {
      DATA.photos.unshift({id: uid(), dataUrl: ev.target.result, caption: '', dateAdded: new Date().toISOString().slice(0,10)});
      count++;
      if(count === fl.length) {
        saveAll(); renderGalleryGrid(); renderGalleryList(); renderMiniPreview();
      }
    };
    r.readAsDataURL(f);
  });
}

/* drag & drop on gallery area */
const galleryArea = document.body;
galleryArea.addEventListener('dragover', e=>{ e.preventDefault(); });
galleryArea.addEventListener('drop', e=>{ e.preventDefault(); if(e.dataTransfer?.files?.length){ addFilesToGallery(e.dataTransfer.files); } });

/* small grid (home) */
function renderGalleryList(){
  const small = $('galleryList'); small.innerHTML='';
  DATA.photos.forEach(ph=>{
    const item = document.createElement('div'); item.className='photo-card';
    item.style.display='flex'; item.style.flexDirection='column';
    item.innerHTML = `<img src="${ph.dataUrl}"><div style="padding:8px;display:flex;justify-content:space-between;align-items:center"><div style="flex:1"><div style="font-weight:800">${escapeHtml(ph.caption||'')}</div><div style="font-size:12px;color:var(--muted)">${ph.dateAdded||''}</div></div><div style="margin-left:8px"><button data-zoom="${ph.id}" class="small-btn">üîç</button></div></div>`;
    small.appendChild(item);
  });
  small.querySelectorAll('[data-zoom]').forEach(b=>b.addEventListener('click', ()=>{ const id = b.dataset.zoom; const ph = DATA.photos.find(x=>x.id===id); if(ph) openLightbox(ph); }));
}

/* export photos (as JSON with images) */
$('exportPhotos').addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify({photos: DATA.photos}, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='fotos_backup.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});

/* add file inputs */
$('addBtn').addEventListener('click', ()=>$('addFiles').click());
$('addFiles').addEventListener('change', e=>{ if(e.target.files.length) addFilesToGallery(e.target.files); e.target.value=''; });

$('addBtn2').addEventListener('click', ()=>$('addFiles2').click());
$('addFiles2').addEventListener('change', e=>{ if(e.target.files.length) addFilesToGallery(e.target.files); e.target.value=''; });

$('filterToday').addEventListener('click', ()=>{ renderGalleryGrid(true); showRoute('gallery'); });
$('showAll').addEventListener('click', ()=>{ renderGalleryGrid(false); showRoute('gallery'); });

$('clearBtn').addEventListener('click', ()=>{ if(confirm('Limpar todas as fotos?')){ DATA.photos=[]; saveAll(); renderGalleryGrid(); renderGalleryList(); renderMiniPreview(); } });

/* ================== DIARY ================== */
$('newDiary').addEventListener('click', ()=>{
  const d = $('diaryDate').value || new Date().toISOString().slice(0,10);
  const id = uid();
  DATA.diary.unshift({id, date:d, title: `Entrada de ${d}`, body: ''});
  saveAll(); renderDiary(); showRoute('diary');
  // auto-open editor
});

function renderDiary(){
  const box = $('diaryList'); box.innerHTML = '';
  DATA.diary.forEach(item=>{
    const e = document.createElement('div'); e.className='entry';
    e.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><strong contenteditable data-dtitle="${item.id}">${escapeHtml(item.title)}</strong><time>${item.date}</time></div><textarea data-dbody="${item.id}" style="margin-top:8px">${escapeHtml(item.body)}</textarea><div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px"><button data-ddel="${item.id}" class="small-btn">Excluir</button></div>`;
    box.appendChild(e);
  });

  box.querySelectorAll('[data-dtitle]').forEach(n=>n.addEventListener('blur', ()=>{ const id = n.dataset.dtitle; const it = DATA.diary.find(x=>x.id===id); if(it) { it.title = n.innerText; saveAll(); } }));
  box.querySelectorAll('[data-dbody]').forEach(t=>t.addEventListener('blur', ()=>{ const id = t.dataset.dbody; const it = DATA.diary.find(x=>x.id===id); if(it){ it.body = t.value; saveAll(); } }));
  box.querySelectorAll('[data-ddel]').forEach(b=>b.addEventListener('click', ()=>{ if(confirm('Remover entrada?')){ const id = b.dataset.ddel; DATA.diary = DATA.diary.filter(x=>x.id!==id); saveAll(); renderDiary(); } }));
}

/* ================== FEELINGS ================== */
$('saveFeeling').addEventListener('click', ()=>{
  const emotion = $('feelEmotion').value.trim() || 'Sem palavra';
  const color = $('feelColor').value;
  const emoji = $('feelEmoji').value || '';
  DATA.feelings.unshift({id: uid(), created: new Date().toISOString(), emotion, color, emoji});
  saveAll(); renderFeelings();
  $('feelEmotion').value=''; $('feelEmoji').value='';
});

function renderFeelings(){
  const box = $('feelList'); box.innerHTML='';
  DATA.feelings.forEach(f=>{
    const el = document.createElement('div'); el.className='entry';
    el.innerHTML = `<div style="display:flex;align-items:center;gap:10px"><div style="width:12px;height:12px;border-radius:4px;background:${f.color}"></div><strong>${escapeHtml(f.emotion)}</strong><div style="margin-left:auto;color:var(--muted);font-size:12px">${new Date(f.created).toLocaleString()}</div></div><div style="font-size:22px;margin-top:6px">${escapeHtml(f.emoji||'')}</div>`;
    box.appendChild(el);
  });
}

/* ================== COMPLAINTS ================== */
$('saveComplaint').addEventListener('click', ()=>{
  const text = $('complaintText').value.trim();
  if(!text) return alert('Escreva algo antes de enviar.');
  const priv = $('complaintPrivate').checked;
  DATA.complaints.unshift({id: uid(), created: new Date().toISOString(), text, private: priv});
  saveAll(); renderComplaints();
  $('complaintText').value=''; $('complaintPrivate').checked=false;
});
$('clearComplaints').addEventListener('click', ()=>{
  if(confirm('Limpar todos os desabafos?')){ DATA.complaints=[]; saveAll(); renderComplaints(); }
});
function renderComplaints(){
  const box = $('complaintList'); box.innerHTML='';
  DATA.complaints.forEach(c=>{
    const e = document.createElement('div'); e.className='entry';
    e.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div style="font-weight:800">${c.private?'<em>Privado</em>':'P√∫blico'}</div><small style="color:var(--muted)">${new Date(c.created).toLocaleString()}</small></div><p style="margin-top:8px">${escapeHtml(c.text)}</p>`;
    box.appendChild(e);
  });
}

/* ================== STORY & ABOUT ================== */
function renderStory(){
  const box = $('story'); box.innerHTML='';
  DATA.story.forEach(s=>{
    const el = document.createElement('div'); el.className='entry';
    el.innerHTML = `<div style="display:flex;justify-content:space-between"><strong contenteditable data-sid="${s.id}">${escapeHtml(s.title)}</strong><small>${s.date}</small></div><p contenteditable data-sdesc="${s.id}" style="margin-top:8px">${escapeHtml(s.desc)}</p>`;
    box.appendChild(el);
  });
  box.querySelectorAll('[data-sid]').forEach(n=>n.addEventListener('blur', ()=>{ const id = n.dataset.sid; const it = DATA.story.find(x=>x.id==id); if(it){ it.title=n.innerText; saveAll(); } }));
  box.querySelectorAll('[data-sdesc]').forEach(n=>n.addEventListener('blur', ()=>{ const id = n.dataset.sdesc; const it = DATA.story.find(x=>x.id==id); if(it){ it.desc=n.innerText; saveAll(); } }));
}
$('aboutText').addEventListener('blur', ()=>{ DATA.about = $('aboutText').innerText; saveAll(); });

/* ================== SURPRISE EFFECTS & SHORTCUTS ================== */
$('rainHearts').addEventListener('click', ()=>{ for(let i=0;i<40;i++){ setTimeout(()=>{ const el = document.createElement('div'); el.style.position='fixed'; el.style.left=Math.random()*100+'%'; el.style.top='-30px'; el.style.fontSize= 14 + Math.random()*18 + 'px'; el.style.zIndex=9999; el.innerText = ['üíñ','üçì','üå∏','‚ú®'][Math.floor(Math.random()*4)]; document.body.appendChild(el); el.animate([{transform:'translateY(0)',opacity:1},{transform:`translateY(${window.innerHeight+100}px)`,opacity:0}],{duration:2500+Math.random()*2000}); setTimeout(()=>el.remove(),4200); }, i*40); }});
$('randomPhrase').addEventListener('click', ()=>{ const arr=['Voc√™ √© meu lugar favorito.','Te amo at√© o infinito e al√©m.','Seu sorriso √© meu sol.']; $('surpriseBox').innerText = arr[Math.floor(Math.random()*arr.length)]; });
$('sparkle').addEventListener('click', ()=>{ const el = document.createElement('div'); el.style.position='fixed'; el.style.left='50%'; el.style.top='30%'; el.style.transform='translate(-50%,-50%)'; el.style.fontSize='48px'; el.style.zIndex=9999; el.innerText='‚ú®‚ú®‚ú®'; document.body.appendChild(el); setTimeout(()=>el.remove(),1200); });

document.querySelectorAll('[data-nav]').forEach(b=>b.addEventListener('click', ()=>{ const r = b.dataset.nav; document.querySelectorAll('.nav-btn').forEach(nb=>nb.classList.remove('active')); document.querySelector(`.nav-btn[data-route="${r}"]`)?.classList.add('active'); showRoute(r); }));

document.querySelectorAll('.quick').forEach(b=>b.addEventListener('click', ()=>{ $('quickBox').innerText = b.dataset.text; }));

/* ================== PERSONALIZE: palette & music & export/import ================== */
$('palDefault').addEventListener('click', ()=>{ document.documentElement.style.setProperty('--page-bg','#fff7fb'); document.documentElement.style.setProperty('--pink-1','#ff6b97'); document.documentElement.style.setProperty('--pink-2','#ffd3e8'); DATA.settings.palette='strawberry'; saveAll(); });
$('palLilac').addEventListener('click', ()=>{ document.documentElement.style.setProperty('--page-bg','#f6f4ff'); document.documentElement.style.setProperty('--pink-1','#9c7cff'); document.documentElement.style.setProperty('--pink-2','#e9ddff'); DATA.settings.palette='lilac'; saveAll(); });
$('palWhite').addEventListener('click', ()=>{ document.documentElement.style.setProperty('--page-bg','#ffffff'); document.documentElement.style.setProperty('--pink-1','#ffd6e7'); document.documentElement.style.setProperty('--pink-2','#fff7fb'); DATA.settings.palette='white'; saveAll(); });

let audio = null;
$('playMusic').addEventListener('click', ()=>{ const url = $('musicUrl').value.trim(); if(!url) return alert('Cole a URL do mp3'); if(audio){ audio.pause(); audio=null; } audio = new Audio(url); audio.loop = true; audio.play(); DATA.settings.music = url; saveAll();});
$('stopMusic').addEventListener('click', ()=>{ if(audio){ audio.pause(); audio=null; } });
$('muteToggle').addEventListener('click', ()=>{ if(audio){ audio.muted = !audio.muted; DATA.settings.mute = audio.muted; saveAll(); alert(audio.muted ? '√Åudio mudo' : '√Åudio ligado'); } });

$('saveAll').addEventListener('click', ()=>{ saveAll(); alert('Salvo!'); });

$('exportBtn').addEventListener('click', ()=>{ const blob = new Blob([JSON.stringify(DATA,null,2)],{type:'application/json'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='backup_nosso_cantinho.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); });

$('importBtn').addEventListener('click', ()=>$('importFile').click());
$('importFile').addEventListener('change', e=>{ const f = e.target.files[0]; if(!f) return; const r = new FileReader(); r.onload = ev => { try{ const parsed = JSON.parse(ev.target.result); DATA = parsed; saveAll(); fullRenders(); alert('Backup importado!'); } catch(err){ alert('Arquivo inv√°lido'); } }; r.readAsText(f); });

/* ================== RENDERS: full ================== */
function fullRenders(){
  renderGalleryGrid(); renderGalleryList(); renderDiary(); renderFeelings(); renderComplaints(); renderStory();
  $('aboutText').innerText = DATA.about || '';
  $('musicUrl').value = DATA.settings.music || '';
  if(DATA.settings.mute && audio) audio.muted = true;
}
function renderGalleryList(){ renderGalleryList = renderGalleryList; const list = $('galleryList'); list.innerHTML=''; DATA.photos.forEach(ph=>{ const el = document.createElement('div'); el.className='photo-card'; el.innerHTML = `<img src="${ph.dataUrl}"><div style="padding:8px;display:flex;justify-content:space-between;align-items:center"><div style="flex:1"><div style="font-weight:800">${escapeHtml(ph.caption||'')}</div><div style="font-size:12px;color:var(--muted)">${ph.dateAdded}</div></div><div style="margin-left:8px"><button data-zoom="${ph.id}" class="small-btn">üîç</button></div></div>`; list.appendChild(el); }); list.querySelectorAll('[data-zoom]').forEach(b=>b.addEventListener('click', ()=>{ const id = b.dataset.zoom; const ph = DATA.photos.find(x=>x.id===id); if(ph) openLightbox(ph); }));
}

function renderGalleryGridIfNeeded(){
  if(document.querySelector('#gallery').classList.contains('active')) renderGalleryGrid(false);
  if(document.querySelector('#home').classList.contains('active')) renderGalleryGrid(false);
}

function initApp(){
  // ensure arrays
  DATA.photos = Array.isArray(DATA.photos) ? DATA.photos : [];
  DATA.diary = Array.isArray(DATA.diary) ? DATA.diary : [];
  DATA.feelings = Array.isArray(DATA.feelings) ? DATA.feelings : [];
  DATA.complaints = Array.isArray(DATA.complaints) ? DATA.complaints : [];
  DATA.story = Array.isArray(DATA.story) ? DATA.story : defaults().story;

  // initial values
  $('diaryDate').value = new Date().toISOString().slice(0,10);

  // render everything
  fullRenders();
  renderMiniPreview();
  renderGalleryGrid();
  renderGalleryList();

  // show home
  showRoute('home');
}

/* initial preview before login */
renderMiniPreview();
renderGalleryGrid();
renderGalleryList();
renderDiary();
renderFeelings();
renderComplaints();
renderStory();

/* keyboard save */
window.addEventListener('keydown', e=>{ if((e.ctrlKey||e.metaKey) && e.key==='s'){ e.preventDefault(); saveAll(); alert('Salvo!'); } });

</script>
</body>
</html>
